-- mysql -u root -p
-- -> chiede password. Inserire root

-- mysql> create user 'contarbn'@'%' identified by 'contarbn';
-- mysql> grant all on contarbn.* to 'contarbn'@'%';
-- mysql> GRANT ALL PRIVILEGES on contarbn.* to 'contarbn'@'%';

CREATE DATABASE  IF NOT EXISTS `contarbn`;
USE `contarbn`;

SET GLOBAL log_bin_trust_function_creators = 1;

-- import dump

SET GLOBAL log_bin_trust_function_creators = 0;


drop table contarbn.listino_prezzo_20230105;

update contarbn.sequence_data
set sequence_cur_value = 0;

truncate table contarbn.ricevuta_privato_totale;
truncate table contarbn.ricevuta_privato_ordine_cliente;
truncate table contarbn.ricevuta_privato_articolo;
delete from contarbn.ricevuta_privato;

truncate table contarbn.pagamento_aggregato;
truncate table contarbn.pagamento;

truncate table contarbn.nota_reso_totale;
truncate table contarbn.nota_reso_riga;
delete from contarbn.nota_reso;

truncate table contarbn.nota_accredito_totale;
truncate table contarbn.nota_accredito_riga;
delete from contarbn.nota_accredito;

truncate table contarbn.fattura_ddt;

truncate table contarbn.fattura_acquisto_ddt_acquisto;
delete from contarbn.fattura_acquisto;

truncate table contarbn.fattura_accom_totale;
truncate table contarbn.fattura_accom_articolo_ordine_cliente;
truncate table contarbn.fattura_accom_articolo;
delete from contarbn.fattura_accom;

truncate table contarbn.fattura_accom_acquisto_totale;
truncate table contarbn.fattura_accom_acquisto_articolo;
truncate table contarbn.fattura_accom_acquisto_ingrediente;
delete from contarbn.fattura_accom_acquisto;

delete from contarbn.fattura;

truncate table contarbn.ddt_articolo_ordine_cliente;
truncate table contarbn.ddt_articolo;
delete from contarbn.ddt;

truncate table contarbn.ddt_acquisto_articolo;
truncate table contarbn.ddt_acquisto_ingrediente;
delete from contarbn.ddt_acquisto;

truncate table contarbn.ordine_fornitore_articolo;
delete from contarbn.ordine_fornitore;

truncate table contarbn.ordine_cliente_articolo;
delete from contarbn.ordine_cliente;

UPDATE contarbn.fornitore
SET ragione_sociale='URBANI ELIA E MARTA', ragione_sociale_2='', indirizzo='Via 11 Settembre, 17', citta='SAN GIOVANNI ILARIONE', provincia='Verona', cap='37035', nazione='Italy', partita_iva='04998580239', codice_fiscale='', telefono='045 6550993', telefono_2='', telefono_3='', email='info@urbanialimentari.com', email_pec='urbanialimentari@legalmail.it', email_ordini='eliaurbani@gmail.com'
WHERE ragione_sociale='URBANI GIUSEPPE';

ALTER DATABASE `contarbn`
DEFAULT CHARACTER SET latin1
DEFAULT COLLATE latin1_general_cs;

ALTER DEFINER=`contarbn` VIEW v_ddt AS select `contarbn`.`ddt`.`id` AS `id`,`contarbn`.`ddt`.`anno_contabile` AS `anno_contabile`,`contarbn`.`ddt`.`progressivo` AS `progressivo`,`contarbn`.`ddt`.`data` AS `data`,`contarbn`.`ddt`.`id_cliente` AS `id_cliente`,`contarbn`.`cliente`.`ragione_sociale` AS `cliente`,`contarbn`.`cliente`.`email` AS `cliente_email`,`contarbn`.`cliente`.`id_agente` AS `id_agente`,concat(`contarbn`.`agente`.`nome`,' ',`contarbn`.`agente`.`cognome`) AS `agente`,`contarbn`.`ddt`.`id_autista` AS `id_autista`,`contarbn`.`ddt`.`id_stato` AS `id_stato`,`contarbn`.`stato_ddt`.`codice` AS `codice`,`contarbn`.`ddt`.`fatturato` AS `fatturato`,`contarbn`.`ddt`.`totale_acconto` AS `totale_acconto`,`contarbn`.`ddt`.`totale` AS `totale`,`contarbn`.`ddt`.`totale_imponibile` AS `totale_imponibile`,`contarbn`.`ddt`.`totale_costo` AS `totale_costo`,`contarbn`.`ddt`.`totale_iva` AS `totale_iva` from (((`contarbn`.`ddt` join `contarbn`.`stato_ddt` on((`contarbn`.`ddt`.`id_stato` = `contarbn`.`stato_ddt`.`id`))) join `contarbn`.`cliente` on((`contarbn`.`ddt`.`id_cliente` = `contarbn`.`cliente`.`id`))) left join `contarbn`.`agente` on((`contarbn`.`cliente`.`id_agente` = `contarbn`.`agente`.`id`)));
ALTER DEFINER=`contarbn` VIEW v_ddt_last AS select `contarbn`.`ddt`.`id` AS `id`,`contarbn`.`ddt`.`id_autista` AS `id_autista` from `contarbn`.`ddt` order by coalesce(`contarbn`.`ddt`.`data_aggiornamento`,`contarbn`.`ddt`.`data_inserimento`) desc limit 1;
ALTER DEFINER=`contarbn` VIEW v_documento_acquisto AS select concat('da_',`contarbn`.`ddt_acquisto`.`id`) AS `id`,'DDT acquisto' AS `tipo_documento`,`contarbn`.`ddt_acquisto`.`id` AS `id_documento`,`contarbn`.`ddt_acquisto`.`numero` AS `num_documento`,`contarbn`.`ddt_acquisto`.`data` AS `data_documento`,`contarbn`.`fornitore`.`id` AS `id_fornitore`,`contarbn`.`fornitore`.`ragione_sociale` AS `ragione_sociale_fornitore`,`contarbn`.`fornitore`.`partita_iva` AS `partita_iva_fornitore`,`contarbn`.`ddt_acquisto`.`id_stato` AS `id_stato`,`contarbn`.`stato_ddt`.`codice` AS `stato`,`contarbn`.`ddt_acquisto`.`totale_imponibile` AS `totale_imponibile`,`contarbn`.`ddt_acquisto`.`totale_iva` AS `totale_iva`,`contarbn`.`ddt_acquisto`.`totale` AS `totale`,`contarbn`.`ddt_acquisto`.`totale_acconto` AS `totale_acconto`,(case when (`contarbn`.`ddt_acquisto`.`fatturato` = 1) then 1 else 0 end) AS `fatturato` from ((`contarbn`.`ddt_acquisto` join `contarbn`.`fornitore` on((`contarbn`.`ddt_acquisto`.`id_fornitore` = `contarbn`.`fornitore`.`id`))) left join `contarbn`.`stato_ddt` on((`contarbn`.`ddt_acquisto`.`id_stato` = `contarbn`.`stato_ddt`.`id`))) union all select concat('fa_',`contarbn`.`fattura_acquisto`.`id`) AS `id`,'Fattura acquisto' AS `tipo_documento`,`contarbn`.`fattura_acquisto`.`id` AS `id_documento`,`contarbn`.`fattura_acquisto`.`numero` AS `num_documento`,`contarbn`.`fattura_acquisto`.`data` AS `data_documento`,`contarbn`.`fornitore`.`id` AS `id_fornitore`,`contarbn`.`fornitore`.`ragione_sociale` AS `ragione_sociale_fornitore`,`contarbn`.`fornitore`.`partita_iva` AS `partita_iva_fornitore`,`contarbn`.`fattura_acquisto`.`id_stato` AS `id_stato`,`contarbn`.`stato_fattura`.`codice` AS `stato`,`contarbn`.`fattura_acquisto`.`totale_imponibile` AS `totale_imponibile`,`contarbn`.`fattura_acquisto`.`totale_iva` AS `totale_iva`,`contarbn`.`fattura_acquisto`.`totale` AS `totale`,`contarbn`.`fattura_acquisto`.`totale_acconto` AS `totale_acconto`,1 AS `fatturato` from ((`contarbn`.`fattura_acquisto` join `contarbn`.`fornitore` on((`contarbn`.`fattura_acquisto`.`id_fornitore` = `contarbn`.`fornitore`.`id`))) left join `contarbn`.`stato_fattura` on((`contarbn`.`fattura_acquisto`.`id_stato` = `contarbn`.`stato_fattura`.`id`))) union all select concat('faa_',`contarbn`.`fattura_accom_acquisto`.`id`) AS `id`,'Fattura accompagnatoria acquisto' AS `tipo_documento`,`contarbn`.`fattura_accom_acquisto`.`id` AS `id_documento`,`contarbn`.`fattura_accom_acquisto`.`numero` AS `num_documento`,`contarbn`.`fattura_accom_acquisto`.`data` AS `data_documento`,`contarbn`.`fornitore`.`id` AS `id_fornitore`,`contarbn`.`fornitore`.`ragione_sociale` AS `ragione_sociale_fornitore`,`contarbn`.`fornitore`.`partita_iva` AS `partita_iva_fornitore`,`contarbn`.`fattura_accom_acquisto`.`id_stato` AS `id_stato`,`contarbn`.`stato_fattura`.`codice` AS `stato`,`contarbn`.`fattura_accom_acquisto`.`totale_imponibile` AS `totale_imponibile`,`contarbn`.`fattura_accom_acquisto`.`totale_iva` AS `totale_iva`,`contarbn`.`fattura_accom_acquisto`.`totale` AS `totale`,`contarbn`.`fattura_accom_acquisto`.`totale_acconto` AS `totale_acconto`,1 AS `fatturato` from ((`contarbn`.`fattura_accom_acquisto` join `contarbn`.`fornitore` on((`contarbn`.`fattura_accom_acquisto`.`id_fornitore` = `contarbn`.`fornitore`.`id`))) left join `contarbn`.`stato_fattura` on((`contarbn`.`fattura_accom_acquisto`.`id_stato` = `contarbn`.`stato_fattura`.`id`)));
ALTER DEFINER=`contarbn` VIEW v_documento_acquisto_ingrediente AS select uuid() AS `id`,'DDT acquisto' AS `tipo_documento`,`contarbn`.`ddt_acquisto`.`id` AS `id_documento`,`contarbn`.`ddt_acquisto`.`numero` AS `num_documento`,`contarbn`.`ddt_acquisto`.`data` AS `data_documento`,`contarbn`.`fornitore`.`id` AS `id_fornitore`,`contarbn`.`fornitore`.`ragione_sociale` AS `ragione_sociale_fornitore`,`contarbn`.`ddt_acquisto_ingrediente`.`lotto` AS `lotto_ingrediente` from ((`contarbn`.`ddt_acquisto` join `contarbn`.`ddt_acquisto_ingrediente` on((`contarbn`.`ddt_acquisto`.`id` = `contarbn`.`ddt_acquisto_ingrediente`.`id_ddt_acquisto`))) join `contarbn`.`fornitore` on((`contarbn`.`ddt_acquisto`.`id_fornitore` = `contarbn`.`fornitore`.`id`))) union all select uuid() AS `id`,'Note reso fornitore' AS `tipo_documento`,`contarbn`.`nota_reso`.`id` AS `id_documento`,concat(`contarbn`.`nota_reso`.`progressivo`,'/',`contarbn`.`nota_reso`.`anno`) AS `num_documento`,`contarbn`.`nota_reso`.`data` AS `data_documento`,`contarbn`.`fornitore`.`id` AS `id_fornitore`,`contarbn`.`fornitore`.`ragione_sociale` AS `ragione_sociale_fornitore`,`contarbn`.`nota_reso_riga`.`lotto` AS `lotto_ingrediente` from ((`contarbn`.`nota_reso` join `contarbn`.`nota_reso_riga` on((`contarbn`.`nota_reso`.`id` = `contarbn`.`nota_reso_riga`.`id_nota_reso`))) join `contarbn`.`fornitore` on((`contarbn`.`nota_reso`.`id_fornitore` = `contarbn`.`fornitore`.`id`)));
ALTER DEFINER=`contarbn` VIEW v_documento_vendita_ingrediente AS select uuid() AS `id`,'DDT' AS `tipo_documento`,`contarbn`.`ddt`.`id` AS `id_documento`,concat(`contarbn`.`ddt`.`progressivo`,'/',`contarbn`.`ddt`.`anno_contabile`) AS `num_documento`,`contarbn`.`ddt`.`data` AS `data_documento`,`contarbn`.`produzione_ingrediente`.`lotto` AS `lotto_ingrediente` from ((((`contarbn`.`ddt` join `contarbn`.`ddt_articolo` on((`contarbn`.`ddt_articolo`.`id_ddt` = `contarbn`.`ddt`.`id`))) join `contarbn`.`produzione_confezione` on((`contarbn`.`produzione_confezione`.`id_articolo` = `contarbn`.`ddt_articolo`.`id_articolo`))) join `contarbn`.`produzione` on((`contarbn`.`produzione`.`id` = `contarbn`.`produzione_confezione`.`id_produzione`))) join `contarbn`.`produzione_ingrediente` on((`contarbn`.`produzione_ingrediente`.`id_produzione` = `contarbn`.`produzione`.`id`))) union all select uuid() AS `id`,'Fattura accompagnatoria' AS `tipo_documento`,`contarbn`.`fattura_accom`.`id` AS `id_documento`,concat(`contarbn`.`fattura_accom`.`progressivo`,'/',`contarbn`.`fattura_accom`.`anno`) AS `num_documento`,`contarbn`.`fattura_accom`.`data` AS `data_documento`,`contarbn`.`produzione_ingrediente`.`lotto` AS `lotto_ingrediente` from ((((`contarbn`.`fattura_accom` join `contarbn`.`fattura_accom_articolo` on((`contarbn`.`fattura_accom_articolo`.`id_fattura_accom` = `contarbn`.`fattura_accom`.`id`))) join `contarbn`.`produzione_confezione` on((`contarbn`.`produzione_confezione`.`id_articolo` = `contarbn`.`fattura_accom_articolo`.`id_articolo`))) join `contarbn`.`produzione` on((`contarbn`.`produzione`.`id` = `contarbn`.`produzione_confezione`.`id_produzione`))) join `contarbn`.`produzione_ingrediente` on((`contarbn`.`produzione_ingrediente`.`id_produzione` = `contarbn`.`produzione`.`id`))) union all select uuid() AS `id`,'Nota accredito' AS `tipo_documento`,`contarbn`.`nota_accredito`.`id` AS `id_documento`,concat(`contarbn`.`nota_accredito`.`progressivo`,'/',`contarbn`.`nota_accredito`.`anno`) AS `num_documento`,`contarbn`.`nota_accredito`.`data` AS `data_documento`,`contarbn`.`produzione_ingrediente`.`lotto` AS `lotto_ingrediente` from ((((`contarbn`.`nota_accredito` join `contarbn`.`nota_accredito_riga` on((`contarbn`.`nota_accredito_riga`.`id_nota_accredito` = `contarbn`.`nota_accredito`.`id`))) join `contarbn`.`produzione_confezione` on((`contarbn`.`produzione_confezione`.`id_articolo` = `contarbn`.`nota_accredito_riga`.`id_articolo`))) join `contarbn`.`produzione` on((`contarbn`.`produzione`.`id` = `contarbn`.`produzione_confezione`.`id_produzione`))) join `contarbn`.`produzione_ingrediente` on((`contarbn`.`produzione_ingrediente`.`id_produzione` = `contarbn`.`produzione`.`id`)));
ALTER DEFINER=`contarbn` VIEW v_fattura_articolo AS select `contarbn`.`fattura`.`id` AS `id_fattura`,`contarbn`.`fattura`.`id_tipo` AS `id_tipo`,group_concat(distinct `contarbn`.`ddt_articolo`.`id_articolo` separator ',') AS `id_articoli` from ((`contarbn`.`fattura` join `contarbn`.`fattura_ddt` on((`contarbn`.`fattura_ddt`.`id_fattura` = `contarbn`.`fattura`.`id`))) join `contarbn`.`ddt_articolo` on((`contarbn`.`ddt_articolo`.`id_ddt` = `contarbn`.`fattura_ddt`.`id_ddt`))) group by `contarbn`.`fattura`.`id`,`contarbn`.`fattura`.`id_tipo` union all select `contarbn`.`fattura_accom`.`id` AS `id_fattura`,`contarbn`.`fattura_accom`.`id_tipo` AS `id_tipo`,group_concat(distinct `contarbn`.`fattura_accom_articolo`.`id_articolo` separator ',') AS `id_articoli` from (`contarbn`.`fattura_accom` join `contarbn`.`fattura_accom_articolo` on((`contarbn`.`fattura_accom_articolo`.`id_fattura_accom` = `contarbn`.`fattura_accom`.`id`))) group by `contarbn`.`fattura_accom`.`id`,`contarbn`.`fattura_accom`.`id_tipo`;
ALTER DEFINER=`contarbn` VIEW v_fattura AS select `contarbn`.`fattura`.`id` AS `id`,`contarbn`.`fattura`.`progressivo` AS `progressivo`,`contarbn`.`fattura`.`anno` AS `anno`,`contarbn`.`fattura`.`data` AS `data`,`contarbn`.`fattura`.`id_tipo` AS `id_tipo`,`contarbn`.`tipo_fattura`.`codice` AS `tipo_codice`,`contarbn`.`fattura`.`id_cliente` AS `id_cliente`,`contarbn`.`cliente`.`ragione_sociale` AS `cliente`,`contarbn`.`cliente`.`email` AS `cliente_email`,`contarbn`.`cliente`.`id_tipo_pagamento` AS `id_tipo_pagamento`,`contarbn`.`cliente`.`id_agente` AS `id_agente`,concat(`contarbn`.`agente`.`nome`,' ',`contarbn`.`agente`.`cognome`) AS `agente`,`contarbn`.`fattura`.`id_stato` AS `id_stato`,`contarbn`.`stato_fattura`.`codice` AS `stato_codice`,`contarbn`.`fattura`.`spedito_ade` AS `spedito_ade`,`contarbn`.`fattura`.`totale_imponibile` AS `totale_imponibile`,`contarbn`.`fattura`.`totale_iva` AS `totale_iva`,`contarbn`.`fattura`.`totale_acconto` AS `totale_acconto`,`contarbn`.`fattura`.`totale` AS `totale`,`contarbn`.`fattura`.`note` AS `note`,`contarbn`.`fattura`.`data_inserimento` AS `data_inserimento`,`contarbn`.`fattura`.`data_aggiornamento` AS `data_aggiornamento`,`contarbn`.`v_fattura_articolo`.`id_articoli` AS `id_articoli` from (((((`contarbn`.`fattura` join `contarbn`.`tipo_fattura` on((`contarbn`.`fattura`.`id_tipo` = `contarbn`.`tipo_fattura`.`id`))) join `contarbn`.`stato_fattura` on((`contarbn`.`fattura`.`id_stato` = `contarbn`.`stato_fattura`.`id`))) join `contarbn`.`cliente` on((`contarbn`.`fattura`.`id_cliente` = `contarbn`.`cliente`.`id`))) left join `contarbn`.`agente` on((`contarbn`.`cliente`.`id_agente` = `contarbn`.`agente`.`id`))) join `contarbn`.`v_fattura_articolo` on(((`contarbn`.`v_fattura_articolo`.`id_tipo` = `contarbn`.`fattura`.`id_tipo`) and (`contarbn`.`v_fattura_articolo`.`id_fattura` = `contarbn`.`fattura`.`id`)))) union all select `contarbn`.`fattura_accom`.`id` AS `id`,`contarbn`.`fattura_accom`.`progressivo` AS `progressivo`,`contarbn`.`fattura_accom`.`anno` AS `anno`,`contarbn`.`fattura_accom`.`data` AS `data`,`contarbn`.`fattura_accom`.`id_tipo` AS `id_tipo`,`contarbn`.`tipo_fattura`.`codice` AS `tipo_codice`,`contarbn`.`fattura_accom`.`id_cliente` AS `id_cliente`,`contarbn`.`cliente`.`ragione_sociale` AS `cliente`,`contarbn`.`cliente`.`email` AS `cliente_email`,`contarbn`.`cliente`.`id_tipo_pagamento` AS `id_tipo_pagamento`,`contarbn`.`cliente`.`id_agente` AS `id_agente`,concat(`contarbn`.`agente`.`nome`,' ',`contarbn`.`agente`.`cognome`) AS `agente`,`contarbn`.`fattura_accom`.`id_stato` AS `id_stato`,`contarbn`.`stato_fattura`.`codice` AS `stato_codice`,`contarbn`.`fattura_accom`.`spedito_ade` AS `spedito_ade`,`contarbn`.`fattura_accom`.`totale_imponibile` AS `totale_imponibile`,`contarbn`.`fattura_accom`.`totale_iva` AS `totale_iva`,`contarbn`.`fattura_accom`.`totale_acconto` AS `totale_acconto`,`contarbn`.`fattura_accom`.`totale` AS `totale`,`contarbn`.`fattura_accom`.`note` AS `note`,`contarbn`.`fattura_accom`.`data_inserimento` AS `data_inserimento`,`contarbn`.`fattura_accom`.`data_aggiornamento` AS `data_aggiornamento`,`contarbn`.`v_fattura_articolo`.`id_articoli` AS `id_articoli` from (((((`contarbn`.`fattura_accom` join `contarbn`.`tipo_fattura` on((`contarbn`.`fattura_accom`.`id_tipo` = `contarbn`.`tipo_fattura`.`id`))) join `contarbn`.`stato_fattura` on((`contarbn`.`fattura_accom`.`id_stato` = `contarbn`.`stato_fattura`.`id`))) join `contarbn`.`cliente` on((`contarbn`.`fattura_accom`.`id_cliente` = `contarbn`.`cliente`.`id`))) left join `contarbn`.`agente` on((`contarbn`.`cliente`.`id_agente` = `contarbn`.`agente`.`id`))) join `contarbn`.`v_fattura_articolo` on(((`contarbn`.`v_fattura_articolo`.`id_tipo` = `contarbn`.`fattura_accom`.`id_tipo`) and (`contarbn`.`v_fattura_articolo`.`id_fattura` = `contarbn`.`fattura_accom`.`id`))));
ALTER DEFINER=`contarbn` VIEW v_fattura_old AS select `contarbn`.`fattura`.`id` AS `id`,`contarbn`.`fattura`.`progressivo` AS `progressivo`,`contarbn`.`fattura`.`anno` AS `anno`,`contarbn`.`fattura`.`data` AS `data`,`contarbn`.`fattura`.`id_tipo` AS `id_tipo`,`contarbn`.`fattura`.`id_cliente` AS `id_cliente`,`contarbn`.`fattura`.`id_stato` AS `id_stato`,`contarbn`.`fattura`.`spedito_ade` AS `spedito_ade`,`contarbn`.`fattura`.`totale_acconto` AS `totale_acconto`,`contarbn`.`fattura`.`totale` AS `totale`,`contarbn`.`fattura`.`note` AS `note`,`contarbn`.`fattura`.`data_inserimento` AS `data_inserimento`,`contarbn`.`fattura`.`data_aggiornamento` AS `data_aggiornamento` from `contarbn`.`fattura` union all select `contarbn`.`fattura_accom`.`id` AS `id`,`contarbn`.`fattura_accom`.`progressivo` AS `progressivo`,`contarbn`.`fattura_accom`.`anno` AS `anno`,`contarbn`.`fattura_accom`.`data` AS `data`,`contarbn`.`fattura_accom`.`id_tipo` AS `id_tipo`,`contarbn`.`fattura_accom`.`id_cliente` AS `id_cliente`,`contarbn`.`fattura_accom`.`id_stato` AS `id_stato`,`contarbn`.`fattura_accom`.`spedito_ade` AS `spedito_ade`,`contarbn`.`fattura_accom`.`totale_acconto` AS `totale_acconto`,`contarbn`.`fattura_accom`.`totale` AS `totale`,`contarbn`.`fattura_accom`.`note` AS `note`,`contarbn`.`fattura_accom`.`data_inserimento` AS `data_inserimento`,`contarbn`.`fattura_accom`.`data_aggiornamento` AS `data_aggiornamento` from `contarbn`.`fattura_accom`;
ALTER DEFINER=`contarbn` VIEW v_giacenza_articolo AS select `contarbn`.`giacenza_articolo`.`id_articolo` AS `id_articolo`,concat(`contarbn`.`articolo`.`codice`,' ',coalesce(`contarbn`.`articolo`.`descrizione`,'')) AS `articolo`,`contarbn`.`articolo`.`prezzo_acquisto` AS `prezzo_acquisto`,`contarbn`.`articolo`.`prezzo_listino_base` AS `prezzo_listino_base`,sum(`contarbn`.`giacenza_articolo`.`quantita`) AS `quantita_tot`,NULL AS `quantita_kg`,group_concat(`contarbn`.`giacenza_articolo`.`id` separator ',') AS `id_giacenze`,group_concat(`contarbn`.`giacenza_articolo`.`lotto` separator ',') AS `lotto_giacenze`,group_concat(`contarbn`.`giacenza_articolo`.`scadenza` separator ',') AS `scadenza_giacenze`,`contarbn`.`articolo`.`attivo` AS `attivo`,`contarbn`.`articolo`.`id_fornitore` AS `id_fornitore`,`contarbn`.`fornitore`.`ragione_sociale` AS `fornitore` from ((`contarbn`.`giacenza_articolo` join `contarbn`.`articolo` on((`contarbn`.`giacenza_articolo`.`id_articolo` = `contarbn`.`articolo`.`id`))) left join `contarbn`.`fornitore` on((`contarbn`.`articolo`.`id_fornitore` = `contarbn`.`fornitore`.`id`))) group by `contarbn`.`giacenza_articolo`.`id_articolo`;
ALTER DEFINER=`contarbn` VIEW v_giacenza_ingrediente AS select `contarbn`.`giacenza_ingrediente`.`id_ingrediente` AS `id_ingrediente`,concat(`contarbn`.`ingrediente`.`codice`,' ',coalesce(`contarbn`.`ingrediente`.`descrizione`,'')) AS `ingrediente`,sum(`contarbn`.`giacenza_ingrediente`.`quantita`) AS `quantita_tot`,group_concat(`contarbn`.`giacenza_ingrediente`.`id` separator ',') AS `id_giacenze`,group_concat(`contarbn`.`giacenza_ingrediente`.`lotto` separator ',') AS `lotto_giacenze`,group_concat(`contarbn`.`giacenza_ingrediente`.`scadenza` separator ',') AS `scadenza_giacenze`,`contarbn`.`ingrediente`.`attivo` AS `attivo`,`contarbn`.`unita_misura`.`etichetta` AS `udm`,`contarbn`.`ingrediente`.`id_fornitore` AS `id_fornitore`,`contarbn`.`fornitore`.`ragione_sociale` AS `fornitore`,`contarbn`.`ingrediente`.`codice` AS `codice_ingrediente`,`contarbn`.`ingrediente`.`descrizione` AS `descrizione_ingrediente` from (((`contarbn`.`giacenza_ingrediente` join `contarbn`.`ingrediente` on((`contarbn`.`giacenza_ingrediente`.`id_ingrediente` = `contarbn`.`ingrediente`.`id`))) left join `contarbn`.`unita_misura` on((`contarbn`.`ingrediente`.`id_unita_misura` = `contarbn`.`unita_misura`.`id`))) left join `contarbn`.`fornitore` on((`contarbn`.`ingrediente`.`id_fornitore` = `contarbn`.`fornitore`.`id`))) group by `contarbn`.`giacenza_ingrediente`.`id_ingrediente`;
ALTER DEFINER=`contarbn` VIEW v_ordine_cliente_articolo AS select uuid() AS `id`,`contarbn`.`ordine_cliente`.`id` AS `id_ordine_cliente`,`contarbn`.`ordine_cliente`.`data_consegna` AS `data_consegna`,`contarbn`.`ordine_cliente_articolo`.`id_articolo` AS `id_articolo`,`contarbn`.`articolo`.`codice` AS `codice_articolo`,`contarbn`.`articolo`.`descrizione` AS `descrizione_articolo`,`contarbn`.`articolo`.`id_fornitore` AS `id_fornitore`,`contarbn`.`ordine_cliente_articolo`.`num_ordinati` AS `num_ordinati`,`contarbn`.`ordine_cliente_articolo`.`num_da_evadere` AS `num_da_evadere` from (((`contarbn`.`ordine_cliente` join `contarbn`.`ordine_cliente_articolo` on((`contarbn`.`ordine_cliente`.`id` = `contarbn`.`ordine_cliente_articolo`.`id_ordine_cliente`))) join `contarbn`.`articolo` on((`contarbn`.`ordine_cliente_articolo`.`id_articolo` = `contarbn`.`articolo`.`id`))) join `contarbn`.`stato_ordine` on((`contarbn`.`ordine_cliente`.`id_stato_ordine` = `contarbn`.`stato_ordine`.`id`))) where ((`contarbn`.`ordine_cliente_articolo`.`id_ordine_fornitore` is null) and (`contarbn`.`stato_ordine`.`codice` <> 'EVASO'));
ALTER DEFINER=`contarbn` VIEW v_ordine_cliente_articolo_da_evadere AS select uuid() AS `id`,`contarbn`.`ordine_cliente`.`id` AS `id_ordine_cliente`,concat('Ordine ',`contarbn`.`ordine_cliente`.`progressivo`,' del ',convert(date_format(`contarbn`.`ordine_cliente`.`data`,'%d/%m/%Y') using latin1),' - ',`contarbn`.`articolo`.`codice`,' ',`contarbn`.`articolo`.`descrizione`,' nr. ',`contarbn`.`ordine_cliente_articolo`.`num_da_evadere`) AS `descrizione`,`contarbn`.`ordine_cliente`.`progressivo` AS `progressivo`,`contarbn`.`ordine_cliente`.`anno_contabile` AS `anno_contabile`,`contarbn`.`ordine_cliente`.`data` AS `data`,`contarbn`.`ordine_cliente_articolo`.`id_articolo` AS `id_articolo`,`contarbn`.`articolo`.`codice` AS `codice_articolo`,`contarbn`.`articolo`.`descrizione` AS `descrizione_articolo`,`contarbn`.`ordine_cliente_articolo`.`num_ordinati` AS `num_ordinati`,`contarbn`.`ordine_cliente_articolo`.`num_da_evadere` AS `num_da_evadere`,`contarbn`.`ordine_cliente`.`id_cliente` AS `id_cliente` from ((`contarbn`.`ordine_cliente` join `contarbn`.`ordine_cliente_articolo` on((`contarbn`.`ordine_cliente_articolo`.`id_ordine_cliente` = `contarbn`.`ordine_cliente`.`id`))) join `contarbn`.`articolo` on((`contarbn`.`articolo`.`id` = `contarbn`.`ordine_cliente_articolo`.`id_articolo`))) where ((`contarbn`.`ordine_cliente`.`id_stato_ordine` <> 2) and (`contarbn`.`ordine_cliente_articolo`.`num_da_evadere` > 0));
ALTER DEFINER=`contarbn` VIEW v_ordine_cliente_stats_month AS select uuid() AS `id`,`contarbn`.`ddt`.`id_cliente` AS `id_cliente`,`contarbn`.`ddt`.`id_punto_consegna` AS `id_punto_consegna`,`contarbn`.`ddt_articolo`.`id_articolo` AS `id_articolo`,`contarbn`.`articolo`.`codice` AS `codice`,`contarbn`.`articolo`.`descrizione` AS `descrizione`,`contarbn`.`articolo`.`prezzo_listino_base` AS `prezzo_listino_base` from ((`contarbn`.`ddt` join `contarbn`.`ddt_articolo` on((`contarbn`.`ddt`.`id` = `contarbn`.`ddt_articolo`.`id_ddt`))) join `contarbn`.`articolo` on((`contarbn`.`ddt_articolo`.`id_articolo` = `contarbn`.`articolo`.`id`))) where ((year(`contarbn`.`ddt`.`data`) = year((curdate() - interval 1 month))) and (month(`contarbn`.`ddt`.`data`) = month((curdate() - interval 1 month)))) union select uuid() AS `id`,`contarbn`.`fattura_accom`.`id_cliente` AS `id_cliente`,`contarbn`.`fattura_accom`.`id_punto_consegna` AS `id_punto_consegna`,`contarbn`.`fattura_accom_articolo`.`id_articolo` AS `id_articolo`,`contarbn`.`articolo`.`codice` AS `codice`,`contarbn`.`articolo`.`descrizione` AS `descrizione`,`contarbn`.`articolo`.`prezzo_listino_base` AS `prezzo_listino_base` from ((`contarbn`.`fattura_accom` join `contarbn`.`fattura_accom_articolo` on((`contarbn`.`fattura_accom`.`id` = `contarbn`.`fattura_accom_articolo`.`id_fattura_accom`))) join `contarbn`.`articolo` on((`contarbn`.`fattura_accom_articolo`.`id_articolo` = `contarbn`.`articolo`.`id`))) where ((year(`contarbn`.`fattura_accom`.`data`) = year((curdate() - interval 1 month))) and (month(`contarbn`.`fattura_accom`.`data`) = month((curdate() - interval 1 month)))) union select uuid() AS `id`,`contarbn`.`nota_accredito`.`id_cliente` AS `id_cliente`,-(1) AS `id_punto_consegna`,`contarbn`.`nota_accredito_riga`.`id_articolo` AS `id_articolo`,`contarbn`.`articolo`.`codice` AS `codice`,`contarbn`.`articolo`.`descrizione` AS `descrizione`,`contarbn`.`articolo`.`prezzo_listino_base` AS `prezzo_listino_base` from ((`contarbn`.`nota_accredito` join `contarbn`.`nota_accredito_riga` on((`contarbn`.`nota_accredito`.`id` = `contarbn`.`nota_accredito_riga`.`id_nota_accredito`))) join `contarbn`.`articolo` on((`contarbn`.`nota_accredito_riga`.`id_articolo` = `contarbn`.`articolo`.`id`))) where ((year(`contarbn`.`nota_accredito`.`data`) = year((curdate() - interval 1 month))) and (month(`contarbn`.`nota_accredito`.`data`) = month((curdate() - interval 1 month))));
ALTER DEFINER=`contarbn` VIEW v_ordine_cliente_stats_week AS select uuid() AS `id`,`contarbn`.`ddt`.`id_cliente` AS `id_cliente`,`contarbn`.`ddt`.`id_punto_consegna` AS `id_punto_consegna`,`contarbn`.`ddt_articolo`.`id_articolo` AS `id_articolo`,`contarbn`.`articolo`.`codice` AS `codice`,`contarbn`.`articolo`.`descrizione` AS `descrizione`,`contarbn`.`articolo`.`prezzo_listino_base` AS `prezzo_listino_base` from ((`contarbn`.`ddt` join `contarbn`.`ddt_articolo` on((`contarbn`.`ddt`.`id` = `contarbn`.`ddt_articolo`.`id_ddt`))) join `contarbn`.`articolo` on((`contarbn`.`ddt_articolo`.`id_articolo` = `contarbn`.`articolo`.`id`))) where ((`contarbn`.`ddt`.`data` >= (now() - interval (dayofweek(now()) + 6) day)) and (`contarbn`.`ddt`.`data` < (now() - interval (dayofweek(now()) - 1) day))) union select uuid() AS `id`,`contarbn`.`fattura_accom`.`id_cliente` AS `id_cliente`,`contarbn`.`fattura_accom`.`id_punto_consegna` AS `id_punto_consegna`,`contarbn`.`fattura_accom_articolo`.`id_articolo` AS `id_articolo`,`contarbn`.`articolo`.`codice` AS `codice`,`contarbn`.`articolo`.`descrizione` AS `descrizione`,`contarbn`.`articolo`.`prezzo_listino_base` AS `prezzo_listino_base` from ((`contarbn`.`fattura_accom` join `contarbn`.`fattura_accom_articolo` on((`contarbn`.`fattura_accom`.`id` = `contarbn`.`fattura_accom_articolo`.`id_fattura_accom`))) join `contarbn`.`articolo` on((`contarbn`.`fattura_accom_articolo`.`id_articolo` = `contarbn`.`articolo`.`id`))) where ((`contarbn`.`fattura_accom`.`data` >= (now() - interval (dayofweek(now()) + 6) day)) and (`contarbn`.`fattura_accom`.`data` < (now() - interval (dayofweek(now()) - 1) day))) union select uuid() AS `id`,`contarbn`.`nota_accredito`.`id_cliente` AS `id_cliente`,-(1) AS `id_punto_consegna`,`contarbn`.`nota_accredito_riga`.`id_articolo` AS `id_articolo`,`contarbn`.`articolo`.`codice` AS `codice`,`contarbn`.`articolo`.`descrizione` AS `descrizione`,`contarbn`.`articolo`.`prezzo_listino_base` AS `prezzo_listino_base` from ((`contarbn`.`nota_accredito` join `contarbn`.`nota_accredito_riga` on((`contarbn`.`nota_accredito`.`id` = `contarbn`.`nota_accredito_riga`.`id_nota_accredito`))) join `contarbn`.`articolo` on((`contarbn`.`nota_accredito_riga`.`id_articolo` = `contarbn`.`articolo`.`id`))) where ((`contarbn`.`nota_accredito`.`data` >= (now() - interval (dayofweek(now()) + 6) day)) and (`contarbn`.`nota_accredito`.`data` < (now() - interval (dayofweek(now()) - 1) day)));
ALTER DEFINER=`contarbn` VIEW v_ordine_fornitore_articolo AS select uuid() AS `id`,`contarbn`.`articolo`.`id` AS `id_articolo`,`contarbn`.`articolo`.`codice` AS `codice_articolo`,`contarbn`.`articolo`.`descrizione` AS `descrizione_articolo`,`contarbn`.`ordine_fornitore_articolo`.`num_ordinati` AS `num_ordinati`,`contarbn`.`ordine_fornitore_articolo`.`id_ordini_clienti` AS `id_ordini_clienti` from (`contarbn`.`ordine_fornitore_articolo` join `contarbn`.`articolo` on((`contarbn`.`ordine_fornitore_articolo`.`id_articolo` = `contarbn`.`articolo`.`id`)));
ALTER DEFINER=`contarbn` VIEW v_pagamento AS select `contarbn`.`pagamento`.`id` AS `id`,`contarbn`.`pagamento`.`data` AS `data`,`contarbn`.`pagamento`.`tipologia` AS `tipologia`,`contarbn`.`pagamento`.`id_tipo_pagamento` AS `id_tipo_pagamento`,`contarbn`.`tipo_pagamento`.`descrizione` AS `tipo_pagamento`,`contarbn`.`pagamento`.`descrizione` AS `descrizione`,`contarbn`.`pagamento`.`note` AS `note`,`contarbn`.`pagamento`.`importo` AS `importo`,`contarbn`.`pagamento`.`id_ddt` AS `id_resource`,`contarbn`.`cliente`.`id` AS `id_cliente`,(case when (`contarbn`.`cliente`.`ditta_individuale` = 1) then concat(`contarbn`.`cliente`.`nome`,' ',`contarbn`.`cliente`.`cognome`) else `contarbn`.`cliente`.`ragione_sociale` end) AS `cliente`,NULL AS `id_fornitore`,NULL AS `fornitore` from (((`contarbn`.`pagamento` join `contarbn`.`tipo_pagamento` on((`contarbn`.`pagamento`.`id_tipo_pagamento` = `contarbn`.`tipo_pagamento`.`id`))) join `contarbn`.`ddt` on((`contarbn`.`pagamento`.`id_ddt` = `contarbn`.`ddt`.`id`))) join `contarbn`.`cliente` on((`contarbn`.`ddt`.`id_cliente` = `contarbn`.`cliente`.`id`))) where (`contarbn`.`pagamento`.`id_ddt` is not null) union all select `contarbn`.`pagamento`.`id` AS `id`,`contarbn`.`pagamento`.`data` AS `data`,`contarbn`.`pagamento`.`tipologia` AS `tipologia`,`contarbn`.`pagamento`.`id_tipo_pagamento` AS `id_tipo_pagamento`,`contarbn`.`tipo_pagamento`.`descrizione` AS `tipo_pagamento`,`contarbn`.`pagamento`.`descrizione` AS `descrizione`,`contarbn`.`pagamento`.`note` AS `note`,`contarbn`.`pagamento`.`importo` AS `importo`,`contarbn`.`pagamento`.`id_fattura` AS `id_resource`,`contarbn`.`cliente`.`id` AS `id_cliente`,(case when (`contarbn`.`cliente`.`ditta_individuale` = 1) then concat(`contarbn`.`cliente`.`nome`,' ',`contarbn`.`cliente`.`cognome`) else `contarbn`.`cliente`.`ragione_sociale` end) AS `cliente`,NULL AS `id_fornitore`,NULL AS `fornitore` from (((`contarbn`.`pagamento` join `contarbn`.`tipo_pagamento` on((`contarbn`.`pagamento`.`id_tipo_pagamento` = `contarbn`.`tipo_pagamento`.`id`))) join `contarbn`.`fattura` on((`contarbn`.`pagamento`.`id_fattura` = `contarbn`.`fattura`.`id`))) join `contarbn`.`cliente` on((`contarbn`.`fattura`.`id_cliente` = `contarbn`.`cliente`.`id`))) where (`contarbn`.`pagamento`.`id_fattura` is not null) union all select `contarbn`.`pagamento`.`id` AS `id`,`contarbn`.`pagamento`.`data` AS `data`,`contarbn`.`pagamento`.`tipologia` AS `tipologia`,`contarbn`.`pagamento`.`id_tipo_pagamento` AS `id_tipo_pagamento`,`contarbn`.`tipo_pagamento`.`descrizione` AS `tipo_pagamento`,`contarbn`.`pagamento`.`descrizione` AS `descrizione`,`contarbn`.`pagamento`.`note` AS `note`,`contarbn`.`pagamento`.`importo` AS `importo`,`contarbn`.`pagamento`.`id_fattura_accom` AS `id_resource`,`contarbn`.`cliente`.`id` AS `id_cliente`,(case when (`contarbn`.`cliente`.`ditta_individuale` = 1) then concat(`contarbn`.`cliente`.`nome`,' ',`contarbn`.`cliente`.`cognome`) else `contarbn`.`cliente`.`ragione_sociale` end) AS `cliente`,NULL AS `id_fornitore`,NULL AS `fornitore` from (((`contarbn`.`pagamento` join `contarbn`.`tipo_pagamento` on((`contarbn`.`pagamento`.`id_tipo_pagamento` = `contarbn`.`tipo_pagamento`.`id`))) join `contarbn`.`fattura_accom` on((`contarbn`.`pagamento`.`id_fattura_accom` = `contarbn`.`fattura_accom`.`id`))) join `contarbn`.`cliente` on((`contarbn`.`fattura_accom`.`id_cliente` = `contarbn`.`cliente`.`id`))) where (`contarbn`.`pagamento`.`id_fattura_accom` is not null) union all select `contarbn`.`pagamento`.`id` AS `id`,`contarbn`.`pagamento`.`data` AS `data`,`contarbn`.`pagamento`.`tipologia` AS `tipologia`,`contarbn`.`pagamento`.`id_tipo_pagamento` AS `id_tipo_pagamento`,`contarbn`.`tipo_pagamento`.`descrizione` AS `tipo_pagamento`,`contarbn`.`pagamento`.`descrizione` AS `descrizione`,`contarbn`.`pagamento`.`note` AS `note`,`contarbn`.`pagamento`.`importo` AS `importo`,`contarbn`.`pagamento`.`id_nota_accredito` AS `id_resource`,`contarbn`.`cliente`.`id` AS `id_cliente`,(case when (`contarbn`.`cliente`.`ditta_individuale` = 1) then concat(`contarbn`.`cliente`.`nome`,' ',`contarbn`.`cliente`.`cognome`) else `contarbn`.`cliente`.`ragione_sociale` end) AS `cliente`,NULL AS `id_fornitore`,NULL AS `fornitore` from (((`contarbn`.`pagamento` left join `contarbn`.`tipo_pagamento` on((`contarbn`.`pagamento`.`id_tipo_pagamento` = `contarbn`.`tipo_pagamento`.`id`))) join `contarbn`.`nota_accredito` on((`contarbn`.`pagamento`.`id_nota_accredito` = `contarbn`.`nota_accredito`.`id`))) join `contarbn`.`cliente` on((`contarbn`.`nota_accredito`.`id_cliente` = `contarbn`.`cliente`.`id`))) where (`contarbn`.`pagamento`.`id_nota_accredito` is not null) union all select `contarbn`.`pagamento`.`id` AS `id`,`contarbn`.`pagamento`.`data` AS `data`,`contarbn`.`pagamento`.`tipologia` AS `tipologia`,`contarbn`.`pagamento`.`id_tipo_pagamento` AS `id_tipo_pagamento`,`contarbn`.`tipo_pagamento`.`descrizione` AS `tipo_pagamento`,`contarbn`.`pagamento`.`descrizione` AS `descrizione`,`contarbn`.`pagamento`.`note` AS `note`,`contarbn`.`pagamento`.`importo` AS `importo`,`contarbn`.`pagamento`.`id_ricevuta_privato` AS `id_resource`,`contarbn`.`cliente`.`id` AS `id_cliente`,concat(`contarbn`.`cliente`.`nome`,' ',`contarbn`.`cliente`.`cognome`) AS `cliente`,NULL AS `id_fornitore`,NULL AS `fornitore` from (((`contarbn`.`pagamento` join `contarbn`.`tipo_pagamento` on((`contarbn`.`pagamento`.`id_tipo_pagamento` = `contarbn`.`tipo_pagamento`.`id`))) join `contarbn`.`ricevuta_privato` on((`contarbn`.`pagamento`.`id_ricevuta_privato` = `contarbn`.`ricevuta_privato`.`id`))) join `contarbn`.`cliente` on((`contarbn`.`ricevuta_privato`.`id_cliente` = `contarbn`.`cliente`.`id`))) where (`contarbn`.`pagamento`.`id_ricevuta_privato` is not null) union all select `contarbn`.`pagamento`.`id` AS `id`,`contarbn`.`pagamento`.`data` AS `data`,`contarbn`.`pagamento`.`tipologia` AS `tipologia`,`contarbn`.`pagamento`.`id_tipo_pagamento` AS `id_tipo_pagamento`,`contarbn`.`tipo_pagamento`.`descrizione` AS `tipo_pagamento`,`contarbn`.`pagamento`.`descrizione` AS `descrizione`,`contarbn`.`pagamento`.`note` AS `note`,`contarbn`.`pagamento`.`importo` AS `importo`,`contarbn`.`pagamento`.`id_nota_reso` AS `id_resource`,NULL AS `id_cliente`,NULL AS `cliente`,`contarbn`.`fornitore`.`id` AS `id_fornitore`,`contarbn`.`fornitore`.`ragione_sociale` AS `fornitore` from (((`contarbn`.`pagamento` left join `contarbn`.`tipo_pagamento` on((`contarbn`.`pagamento`.`id_tipo_pagamento` = `contarbn`.`tipo_pagamento`.`id`))) join `contarbn`.`nota_reso` on((`contarbn`.`pagamento`.`id_nota_reso` = `contarbn`.`nota_reso`.`id`))) join `contarbn`.`fornitore` on((`contarbn`.`nota_reso`.`id_fornitore` = `contarbn`.`fornitore`.`id`))) where (`contarbn`.`pagamento`.`id_nota_reso` is not null) union all select `contarbn`.`pagamento`.`id` AS `id`,`contarbn`.`pagamento`.`data` AS `data`,`contarbn`.`pagamento`.`tipologia` AS `tipologia`,`contarbn`.`pagamento`.`id_tipo_pagamento` AS `id_tipo_pagamento`,`contarbn`.`tipo_pagamento`.`descrizione` AS `tipo_pagamento`,`contarbn`.`pagamento`.`descrizione` AS `descrizione`,`contarbn`.`pagamento`.`note` AS `note`,`contarbn`.`pagamento`.`importo` AS `importo`,`contarbn`.`pagamento`.`id_ddt_acquisto` AS `id_resource`,NULL AS `id_cliente`,NULL AS `cliente`,`contarbn`.`fornitore`.`id` AS `id_fornitore`,`contarbn`.`fornitore`.`ragione_sociale` AS `fornitore` from (((`contarbn`.`pagamento` left join `contarbn`.`tipo_pagamento` on((`contarbn`.`pagamento`.`id_tipo_pagamento` = `contarbn`.`tipo_pagamento`.`id`))) join `contarbn`.`ddt_acquisto` on((`contarbn`.`pagamento`.`id_ddt_acquisto` = `contarbn`.`ddt_acquisto`.`id`))) join `contarbn`.`fornitore` on((`contarbn`.`ddt_acquisto`.`id_fornitore` = `contarbn`.`fornitore`.`id`))) where (`contarbn`.`pagamento`.`id_ddt_acquisto` is not null) union all select `contarbn`.`pagamento`.`id` AS `id`,`contarbn`.`pagamento`.`data` AS `data`,`contarbn`.`pagamento`.`tipologia` AS `tipologia`,`contarbn`.`pagamento`.`id_tipo_pagamento` AS `id_tipo_pagamento`,`contarbn`.`tipo_pagamento`.`descrizione` AS `tipo_pagamento`,`contarbn`.`pagamento`.`descrizione` AS `descrizione`,`contarbn`.`pagamento`.`note` AS `note`,`contarbn`.`pagamento`.`importo` AS `importo`,`contarbn`.`pagamento`.`id_fattura_acquisto` AS `id_resource`,NULL AS `id_cliente`,NULL AS `cliente`,`contarbn`.`fornitore`.`id` AS `id_fornitore`,`contarbn`.`fornitore`.`ragione_sociale` AS `fornitore` from (((`contarbn`.`pagamento` left join `contarbn`.`tipo_pagamento` on((`contarbn`.`pagamento`.`id_tipo_pagamento` = `contarbn`.`tipo_pagamento`.`id`))) join `contarbn`.`fattura_acquisto` on((`contarbn`.`pagamento`.`id_fattura_acquisto` = `contarbn`.`fattura_acquisto`.`id`))) join `contarbn`.`fornitore` on((`contarbn`.`fattura_acquisto`.`id_fornitore` = `contarbn`.`fornitore`.`id`))) where (`contarbn`.`pagamento`.`id_fattura_acquisto` is not null) union all select `contarbn`.`pagamento`.`id` AS `id`,`contarbn`.`pagamento`.`data` AS `data`,`contarbn`.`pagamento`.`tipologia` AS `tipologia`,`contarbn`.`pagamento`.`id_tipo_pagamento` AS `id_tipo_pagamento`,`contarbn`.`tipo_pagamento`.`descrizione` AS `tipo_pagamento`,`contarbn`.`pagamento`.`descrizione` AS `descrizione`,`contarbn`.`pagamento`.`note` AS `note`,`contarbn`.`pagamento`.`importo` AS `importo`,`contarbn`.`pagamento`.`id_fattura_accom_acquisto` AS `id_resource`,NULL AS `id_cliente`,NULL AS `cliente`,`contarbn`.`fornitore`.`id` AS `id_fornitore`,`contarbn`.`fornitore`.`ragione_sociale` AS `fornitore` from (((`contarbn`.`pagamento` left join `contarbn`.`tipo_pagamento` on((`contarbn`.`pagamento`.`id_tipo_pagamento` = `contarbn`.`tipo_pagamento`.`id`))) join `contarbn`.`fattura_accom_acquisto` on((`contarbn`.`pagamento`.`id_fattura_accom_acquisto` = `contarbn`.`fattura_accom_acquisto`.`id`))) join `contarbn`.`fornitore` on((`contarbn`.`fattura_accom_acquisto`.`id_fornitore` = `contarbn`.`fornitore`.`id`))) where (`contarbn`.`pagamento`.`id_fattura_accom_acquisto` is not null);
ALTER DEFINER=`contarbn` VIEW v_produzione AS select uuid() AS `id`,`contarbn`.`produzione`.`id` AS `id_produzione`,`contarbn`.`produzione`.`codice` AS `codice_produzione`,`contarbn`.`produzione`.`data_produzione` AS `data_produzione`,`contarbn`.`produzione`.`tipologia` AS `tipologia`,`contarbn`.`produzione_confezione`.`id_confezione` AS `id_confezione`,`contarbn`.`produzione`.`lotto` AS `lotto`,`contarbn`.`produzione`.`scadenza` AS `scadenza`,`contarbn`.`produzione_confezione`.`id_articolo` AS `id_articolo`,`contarbn`.`articolo`.`codice` AS `codice_articolo`,`contarbn`.`articolo`.`descrizione` AS `descrizione_articolo`,`contarbn`.`produzione_confezione`.`id_ingrediente` AS `id_ingrediente`,`contarbn`.`ingrediente`.`codice` AS `codice_ingrediente`,`contarbn`.`ingrediente`.`descrizione` AS `descrizione_ingrediente`,`contarbn`.`produzione_confezione`.`num_confezioni_prodotte` AS `num_confezioni_prodotte`,`contarbn`.`produzione`.`quantita_totale` AS `quantita`,concat(`contarbn`.`ricetta`.`codice`,' ',`contarbn`.`ricetta`.`nome`) AS `ricetta`,`contarbn`.`produzione`.`barcode_ean_13` AS `barcode_ean_13`,`contarbn`.`produzione`.`barcode_ean_128` AS `barcode_ean_128` from ((((`contarbn`.`produzione_confezione` join `contarbn`.`produzione` on((`contarbn`.`produzione_confezione`.`id_produzione` = `contarbn`.`produzione`.`id`))) join `contarbn`.`ricetta` on((`contarbn`.`produzione`.`id_ricetta` = `contarbn`.`ricetta`.`id`))) left join `contarbn`.`articolo` on((`contarbn`.`produzione_confezione`.`id_articolo` = `contarbn`.`articolo`.`id`))) left join `contarbn`.`ingrediente` on((`contarbn`.`produzione_confezione`.`id_ingrediente` = `contarbn`.`ingrediente`.`id`)));
ALTER DEFINER=`contarbn` VIEW v_produzione_confezione AS select uuid() AS `id`,`contarbn`.`produzione`.`id` AS `id_produzione`,`contarbn`.`produzione`.`codice` AS `codice_produzione`,`contarbn`.`produzione`.`data_produzione` AS `data_produzione`,`contarbn`.`produzione`.`tipologia` AS `tipologia`,`contarbn`.`produzione_confezione`.`id_confezione` AS `id_confezione`,`contarbn`.`produzione_confezione`.`num_confezioni` AS `num_confezioni`,`contarbn`.`produzione_confezione`.`num_confezioni_prodotte` AS `num_confezioni_prodotte`,`contarbn`.`produzione_confezione`.`lotto` AS `lotto_confezione`,`contarbn`.`confezione`.`tipo` AS `tipo_confezione`,`contarbn`.`produzione`.`lotto` AS `lotto_produzione`,`contarbn`.`produzione`.`scadenza` AS `scadenza`,`contarbn`.`produzione_confezione`.`id_articolo` AS `id_articolo`,`contarbn`.`articolo`.`codice` AS `codice_articolo`,`contarbn`.`articolo`.`descrizione` AS `descrizione_articolo`,`contarbn`.`produzione_confezione`.`id_ingrediente` AS `id_ingrediente`,`contarbn`.`ingrediente`.`codice` AS `codice_ingrediente`,`contarbn`.`ingrediente`.`descrizione` AS `descrizione_ingrediente`,`contarbn`.`produzione`.`quantita_totale` AS `quantita`,concat(`contarbn`.`ricetta`.`codice`,' ',`contarbn`.`ricetta`.`nome`) AS `ricetta` from (((((`contarbn`.`produzione` join `contarbn`.`produzione_confezione` on((`contarbn`.`produzione`.`id` = `contarbn`.`produzione_confezione`.`id_produzione`))) join `contarbn`.`confezione` on((`contarbn`.`produzione_confezione`.`id_confezione` = `contarbn`.`confezione`.`id`))) join `contarbn`.`ricetta` on((`contarbn`.`produzione`.`id_ricetta` = `contarbn`.`ricetta`.`id`))) left join `contarbn`.`articolo` on((`contarbn`.`produzione_confezione`.`id_articolo` = `contarbn`.`articolo`.`id`))) left join `contarbn`.`ingrediente` on((`contarbn`.`produzione_confezione`.`id_ingrediente` = `contarbn`.`ingrediente`.`id`)));
ALTER DEFINER=`contarbn` VIEW v_produzione_etichetta AS select `contarbn`.`produzione`.`id` AS `id`,`contarbn`.`produzione`.`lotto` AS `lotto`,`contarbn`.`produzione`.`scadenza` AS `scadenza`,`contarbn`.`ricetta`.`nome` AS `articolo`,group_concat(distinct `contarbn`.`ingrediente`.`descrizione` order by `contarbn`.`ingrediente`.`descrizione` ASC separator ',') AS `ingredienti` from (((`contarbn`.`produzione` join `contarbn`.`ricetta` on((`contarbn`.`produzione`.`id_ricetta` = `contarbn`.`ricetta`.`id`))) left join `contarbn`.`produzione_ingrediente` on((`contarbn`.`produzione`.`id` = `contarbn`.`produzione_ingrediente`.`id_produzione`))) left join `contarbn`.`ingrediente` on((`contarbn`.`produzione_ingrediente`.`id_ingrediente` = `contarbn`.`ingrediente`.`id`))) group by `contarbn`.`produzione`.`id`,`contarbn`.`produzione`.`lotto`,`contarbn`.`produzione`.`scadenza`,`contarbn`.`ricetta`.`nome`;
ALTER DEFINER=`contarbn` VIEW v_produzione_ingrediente AS select uuid() AS `id`,`contarbn`.`produzione`.`id` AS `id_produzione`,`contarbn`.`produzione`.`codice` AS `codice_produzione`,`contarbn`.`produzione`.`data_produzione` AS `data_produzione`,`contarbn`.`produzione`.`tipologia` AS `tipologia`,`contarbn`.`produzione`.`lotto` AS `lotto_produzione`,`contarbn`.`produzione`.`scadenza` AS `scadenza`,`contarbn`.`produzione_ingrediente`.`lotto` AS `lotto_ingrediente`,`contarbn`.`ingrediente`.`id` AS `id_ingrediente`,`contarbn`.`ingrediente`.`codice` AS `codice_ingrediente`,`contarbn`.`ingrediente`.`descrizione` AS `descrizione_ingrediente`,`contarbn`.`produzione`.`quantita_totale` AS `quantita`,concat(`contarbn`.`ricetta`.`codice`,' ',`contarbn`.`ricetta`.`nome`) AS `ricetta` from (((`contarbn`.`produzione` join `contarbn`.`produzione_ingrediente` on((`contarbn`.`produzione`.`id` = `contarbn`.`produzione_ingrediente`.`id_produzione`))) join `contarbn`.`ingrediente` on((`contarbn`.`produzione_ingrediente`.`id_ingrediente` = `contarbn`.`ingrediente`.`id`))) join `contarbn`.`ricetta` on((`contarbn`.`produzione`.`id_ricetta` = `contarbn`.`ricetta`.`id`)));

